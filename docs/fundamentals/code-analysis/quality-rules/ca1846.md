---
title: "CA1846: Prefer `AsSpan` over `Substring`"
description: "Learn about code analysis rule CA1846: Prefer `AsSpan` over `Substring`"
ms.date: 05/21/2021
ms.topic: reference
f1_keywords:
- CA1846
- PreferAsSpanOverSubstring
helpviewer_keywords:
- PreferAsSpanOverSubstring
- CA1846
author: NewellClark
dev_langs:
- CSharp
- VB
---
# CA1846: Prefer `AsSpan` over `Substring`

| | Value |
|-|-|
| **Rule ID** |CA1846|
| **Category** |[Performance](performance-warnings.md)|
| **Fix is breaking or non-breaking** |Non-breaking|

## Cause

The result of a call to <xref:System.String.Substring(System.Int32)> or <xref:System.String.Substring(System.Int32, System.Int32)> is passed to a method with an available overload that accepts <xref:System.ReadOnlySpan{System.Char}>.

## Rule description

`Substring` allocates a new `string` object on the heap and performs a full copy of the extracted text. String manipulation is a performance bottleneck for many programs. Allocating many small short-lived strings on a hot path can create enough collection pressure to impact performance. The O(n) copies created by `Substring` become relevant when the substrings get large. <xref:System.Span%601> and <xref:System.ReadOnlySpan%601> were created to solve these performance problems.

Many APIs that accept strings provide overloads that accept <xref:System.ReadOnlySpan{System.Char}>. When such overloads are available, you can improve performance by calling `AsSpan` instead of `Substring`.

## How to fix violations

To fix violations of this rule, replace the call to `string.Substring` with a call to one of the `AsSpan` extension methods.

```csharp
using System;

public void MyMethod(string iniFileLine)
{
    // Violation
    int.TryParse(iniFileLine.Substring(7), out int x);
    int.TryParse(iniFileLine.Substring(2, 5), out int y);
    
    // Fix
    int.TryParse(iniFileLine.AsSpan(7), out int x);
    int.TryParse(iniFileLine.AsSpan(2, 5), out int y);
}
```

## When to suppress warnings

It is safe to suppress warnings from this rule if you do not care about performance.

## See also

- [Performance warnings](performance-warnings.md)
