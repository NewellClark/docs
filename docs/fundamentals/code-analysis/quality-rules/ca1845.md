---
title: "CA1845: Use span-based 'string.Concat' (analysis rule)"
description: "Learn about code analysis rule CA1845: Use span-based 'string.Concat'"
ms.date: 05/18/2021
ms.topic: reference
f1_keywords:
  - "UseSpanBasedStringConcat"
  - "CA1845"
helpviewer_keywords:
  - "UseSpanBasedStringConcat"
  - "CA1845"
author: NewellClark
dev_langs:
  - CSharp
  - VB
---
# CA1845: Use span-based 'string.Concat'

| | Value |
|-|-|
| **Rule ID** |CA1845|
| **Category** |[Performance](performance-warnings.md)|
| **Fix is breaking or non-breaking** |Non-breaking|

## Cause

This rule locates string-concatenation expressions that contain `Substring` calls and suggests replacing `Substring` with `AsSpan` and using the span-based overload of `string.Concat`.

## Rule description

Calling `Substring` produces a copy of the extracted substring. By using `AsSpan` instead of `Substring` and calling the overload of `string.Concat` which accepts spans, we can eliminate this unnecessary string allocation. 

## How to fix violations

To fix violations, 
1) Replace the string concatenation with a call to `string.Concat`, and 
2) 2) Replace calls to `Substring` with calls to `AsSpan`.

The following code snippet shows examples of violations, and how to fix them.

```csharp
using System;

class Example
{
    public void Method()
    {
        string cliche = "hello world";
        
        //  Violation: result of Substring only used in concatenation. Extra allocation is unnecessary.
        string s1 = cliche.Substring(6, 5) + cliche.Substring(5) + " is reversed!";
        
        //  Better: by using AsSpan, we avoid allocating temporary strings.
        string s2 = string.Concat(cliche.AsSpan(6, 5), cliche.AsSpan(5), " is reversed!");
    }
}
```

## When to suppress warnings

Do not suppress warnings from this rule. There is no reason to use `Substring` over `AsSpan` when the extracted substring is only being passed to a method with a span-based equivalent.

## See also

- [Performance rules](performance-warnings.md)
